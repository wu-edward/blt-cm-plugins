# This file can be added to `$settings['container_yamls']` in settings.php
# so that these service definitions will be added to the container even during
# site installation.
#
# @example
# @code
#
# // Add services to be able to use and enable config splits based on separate
# // profiles when installing Drupal from existing configuration.
# $settings['container_yamls'][] = {PATH TO VENDOR}/wu-edward/blt-cm-plugins/profile_split_services.yml';
# @endcode

services:
  # Override the config sync storage so that the core.extension.yml profile is ignored.
  blt_cm_plugins.profile_split.config.storage.sync:
    class: BltCm\Drupal\Config\ProfileSplitSyncStorage
    decorates: config.storage.sync
    # Set decoration priority to try to ensure this will run last.
    decoration_priority: -1000
    public: false
    arguments: ['@blt_cm_plugins.profile_split.config.storage.sync.inner', '@config.storage', '@extension.list.profile', '%install_profile%']

  blt_cm_plugins.profile_split.overrider:
    class: BltCm\Drupal\Config\ProfileSplitConfigOverrides
    arguments: ['@entity_type.manager', '%install_profile%']
    tags:
      - { name: config.factory.override, priority: 5 }
